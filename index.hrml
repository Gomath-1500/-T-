<!DOCTYPE html>

<html lang="ko">

<head>

<meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>ê³ ìˆ˜í•™ ë°ì¼ë¦¬ ë¦¬í¬íŠ¸ ìƒì„±ê¸° v4 â€“ Hybrid</title>

<style>

Â  :root { --bg:#0b1020;--panel:#111833;--muted:#7780a1;--text:#eef1ff;--brand:#5aa6ff;--good:#22c55e;--warn:#f59e0b;--bad:#ef4444; }

Â  *{box-sizing:border-box}

Â  body{margin:0;background:linear-gradient(180deg,#0b1020,#0c1226 40%,#0b1020);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif}

Â  .wrap{max-width:980px;margin:32px auto;padding:0 16px}

Â  h1{font-size:26px;margin:0 0 12px;display:flex;gap:10px;align-items:center}

Â  .card{background:var(--panel);border:1px solid #1f2a4a;border-radius:16px;padding:16px;margin:14px 0;box-shadow:0 8px 24px rgba(0,0,0,.25)}

Â  label{font-weight:600;color:#cfd7ff;display:block;margin:12px 0 8px}

Â  textarea,input,select{width:100%;color:var(--text);background:#0e1530;border:1px solid #23305a;border-radius:10px;padding:10px 12px;outline:none}

Â  textarea{min-height:120px;resize:vertical}

Â  input:focus,textarea:focus{border-color:var(--brand);box-shadow:0 0 0 2px #2b7fff22}

Â  .grid{display:grid;gap:12px}

Â  .g2{grid-template-columns:1fr 1fr}

Â  .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:700;cursor:pointer}

Â  .btn.primary{background:linear-gradient(135deg,#4aa3ff,#7cc8ff);color:#071226}

Â  .btn.secondary{background:#1b2546;color:#dbe5ff;border:1px solid #2a396b}

Â  .btn.ghost{background:transparent;color:#c9d6ff;border:1px dashed #33436f}

Â  .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}

Â  .muted{color:var(--muted);font-size:13px}

Â  .reports{display:grid;gap:10px}

Â  .report{white-space:pre-wrap;background:#0f1633;border:1px solid #26335e;border-radius:12px;padding:12px}

Â  .report[contenteditable="true"]:focus{outline:2px solid var(--brand)}

Â  .chip{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border-radius:999px;background:#0f1b3c;border:1px solid #2a3b6e}

Â  .ok{color:var(--good)} .warn{color:var(--warn)} .bad{color:var(--bad)}

Â  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0b1330;border:1px solid #2a3b6e;border-bottom-width:3px;border-radius:8px;padding:2px 6px}

Â  .right{margin-left:auto}

Â  .row .chip input[type="checkbox"]{transform:translateY(1px)}

Â  .btn.sm{padding:6px 10px;font-size:12px;border-radius:10px}

Â  .report-item{margin-bottom:10px}

</style>

</head>

<body>

Â  <div class="wrap">

Â  Â  <h1>ğŸ“‹ ê³ ìˆ˜í•™ ë°ì¼ë¦¬ ë¦¬í¬íŠ¸ ìƒì„±ê¸° <span class="chip"><span class="ok">v4</span> Hybrid</span></h1>

Â  Â  <div class="card">

Â  Â  Â  <div class="grid">

Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  <label>ì…ë ¥ ë°ì´í„° (í•œêº¼ë²ˆì— ë¶™ì—¬ë„£ê¸°)</label>

Â  Â  Â  Â  Â  <textarea id="inputData" placeholder="ì˜ˆ)

ë°˜ëª…: ì¤‘3T(ìˆ˜ìš©)

ì§„ë„: ì¤‘3-1 ìˆ˜ì—´ì˜ í•©(Î£), ë“±ì°¨ìˆ˜ì—´ ì¼ë°˜í•­

ê³¼ì œ: ì¤‘3-1 ìˆ˜ì—´ P1~P3, ì˜¤ë‹µì •ë¦¬

í…ŒìŠ¤íŠ¸ ë²”ìœ„: ì¤‘3-1 ë“±ì°¨ìˆ˜ì—´ ëŒ€í‘œìœ í˜• (6)

í•™ìƒ: ì´ì¢…ì°¬ 5 ì ê·¹ì , ê¹€ìœ ê²¸ ê²°ì„, ë°•íƒœì˜ 4 ì§€ê°10ë¶„ ì¡¸ìŒ, êµ¬ë™ê±´ ë¯¸ì‘ì‹œ(ì‚¬ìœ : ì¡°í‡´)"></textarea>

Â  Â  Â  Â  Â  <div class="muted">ğŸ§© í¬ë§· íŒíŠ¸: <span class="kbd">ë°˜ëª…:</span> <span class="kbd">ì§„ë„:</span> <span class="kbd">ê³¼ì œ:</span> <span class="kbd">í…ŒìŠ¤íŠ¸ ë²”ìœ„:</span> <span class="kbd">í•™ìƒ:</span> (ì‰¼í‘œë¡œ êµ¬ë¶„)</div>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  <label>ë‹´ì„ì„ ìƒë‹˜ ì´ë¦„</label>

Â  Â  Â  Â  Â  <input id="teacherName" placeholder="ì˜ˆ) ë°•ìš©" />

Â  Â  Â  Â  Â  <div class="grid g2">

Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  <label>ë¦¬í¬íŠ¸ ë‚ ì§œ</label>

Â  Â  Â  Â  Â  Â  Â  <div class="row">

Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="reportDate" />

Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn secondary sm" id="btn-today">ì˜¤ëŠ˜ ë‚ ì§œ</button>

Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div class="muted">í˜ì´ì§€ê°€ ì—´ë¦¬ë©´ ìë™ìœ¼ë¡œ ì˜¤ëŠ˜ ë‚ ì§œê°€ ì…ë ¥ë©ë‹ˆë‹¤.</div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  Â  <label>ê¸°ë³¸ ê°’</label>

Â  Â  Â  Â  Â  Â  Â  <select id="defaults">

Â  Â  Â  Â  Â  Â  Â  Â  <option value="ì •ìƒ|ìš°ìˆ˜|ì •ìƒ">ì¶œê²° ì •ìƒ Â· íƒœë„ ìš°ìˆ˜ Â· ê³¼ì œ ì •ìƒ</option>

Â  Â  Â  Â  Â  Â  Â  Â  <option value="ì •ìƒ|ë³´í†µ|ì •ìƒ">ì¶œê²° ì •ìƒ Â· íƒœë„ ë³´í†µ Â· ê³¼ì œ ì •ìƒ</option>

Â  Â  Â  Â  Â  Â  Â  Â  <option value="ì •ìƒ|ìš°ìˆ˜|ë¯¸í¡">ì¶œê²° ì •ìƒ Â· íƒœë„ ìš°ìˆ˜ Â· ê³¼ì œ ë¯¸í¡</option>

Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <label>ë°˜ë³„ ê³µì§€ì‚¬í•­</label>

Â  Â  Â  Â  Â  <textarea id="notice" placeholder="ì˜ˆ) ì´ë²ˆ ì£¼ í† ìš”ì¼ ì§„ë‹¨í‰ê°€ ì‹¤ì‹œ, ì‹œí—˜ë²”ìœ„ ê³µì§€ ì˜ˆì • ë“±"></textarea>

Â  Â  Â  Â  Â  <label>ì¶”ê°€ ìš”êµ¬ì¡°ê±´ (í†¤Â·íŠ¹ì • ë©˜íŠ¸ ë“±)</label>

Â  Â  Â  Â  Â  <textarea id="extraRequest" placeholder="ì˜ˆ) ì¸ì‚¬ë§ì— â€˜ê³ ìˆ˜í•™â€™ ê°•ì¡°, ë°˜ëª…ì€ ì¸ì‚¬ë§ì—ì„œ ìƒëµ"></textarea>

Â  Â  Â  Â  </div>

Â  Â  Â  </div>

Â  Â  Â  <div class="row" style="margin-top:10px">

Â  Â  Â  Â  <button class="btn primary" id="btn-generate">ë¦¬í¬íŠ¸ ìƒì„±</button>

Â  Â  Â  Â  <button class="btn secondary" id="btn-sample">ìƒ˜í”Œ ì…ë ¥</button>

Â  Â  Â  Â  <button class="btn ghost" id="btn-clear">ì´ˆê¸°í™”</button>

Â  Â  Â  Â  <span class="right"></span>

Â  Â  Â  </div>

Â  Â  Â  <div class="row" style="margin-top:8px">

Â  Â  Â  Â  <label class="chip" style="cursor:pointer">

Â  Â  Â  Â  Â  <input type="checkbox" id="useGpt" checked /> AI ë³´ê°•(GPT)

Â  Â  Â  Â  </label>

Â  Â  Â  Â  <input id="gptEndpoint" placeholder="ì˜ˆ) http://localhost:3000/generate" />

Â  Â  Â  Â  <span class="muted">í‚¤ëŠ” ì„œë²„(.env)ì—ë§Œ ë³´ê´€í•˜ì„¸ìš”. ì‹¤íŒ¨ ì‹œ ìë™ìœ¼ë¡œ ë¡œì»¬ í…œí”Œë¦¿ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.</span>

Â  Â  Â  </div>

Â  Â  </div>



Â  Â  <div class="card">

Â  Â  Â  <div class="row">

Â  Â  Â  Â  <div class="chip">ì¶œë ¥ <span id="count" class="muted">0ê±´</span></div>

Â  Â  Â  Â  <button class="btn secondary" id="btn-copy-all">ğŸ“‹ ë°˜ ì „ì²´ ë³µì‚¬</button>

Â  Â  Â  Â  <button class="btn secondary" id="btn-download">â¬‡ï¸ TXTë¡œ ì €ì¥</button>

Â  Â  Â  </div>

Â  Â  Â  <div id="reports" class="reports" style="margin-top:12px"></div>

Â  Â  </div>



Â  Â  <div class="muted">ğŸ’¡ ê·œì¹™ ìš”ì•½: â€œì•ˆë…•í•˜ì„¸ìš”. ê³ ìˆ˜í•™ í•™ì›ì…ë‹ˆë‹¤.â€ë¡œ ì‹œì‘, ì ìˆ˜ 100ì  í™˜ì‚°, ìˆ˜ì—…ë¦¬ë·°ëŠ” ì¡´ëŒ“ë§ ë¬¸ì¥ë§ˆë‹¤ ì¤„ë°”ê¿ˆ, í…ŒìŠ¤íŠ¸ ë¯¸ì‘ì‹œëŠ” ë°˜ë“œì‹œ ì‚¬ìœ  í‘œê¸°, ë‹¨ì› ê°œë… 1ê°œ ì´ìƒ ì–¸ê¸‰.</div>

Â  </div>



<script>

const $ = (sel)=>document.querySelector(sel);

const $$ = (sel)=>Array.from(document.querySelectorAll(sel));



// ===== ì•ˆì •ì ì¸ ë³µì‚¬ ìœ í‹¸ (3ë‹¨ê³„ í´ë°±) =====

async function copyToClipboard(text){

Â  try{

Â  Â  if(navigator.clipboard){

Â  Â  Â  await navigator.clipboard.writeText(text);

Â  Â  Â  return true;

Â  Â  }

Â  }catch(e){ console.warn('navigator.clipboard ì‹¤íŒ¨', e); }

Â  try{

Â  Â  const ta = document.createElement('textarea');

Â  Â  ta.value = text; ta.setAttribute('readonly','');

Â  Â  ta.style.position='fixed'; ta.style.top='-9999px';

Â  Â  document.body.appendChild(ta);

Â  Â  ta.focus(); ta.select();

Â  Â  const ok = document.execCommand('copy');

Â  Â  document.body.removeChild(ta);

Â  Â  if(ok) return true;

Â  }catch(e){ console.warn('execCommand(copy) ì‹¤íŒ¨', e); }

Â  return false;

}

function selectNodeText(el){

Â  const range = document.createRange();

Â  range.selectNodeContents(el);

Â  const sel = window.getSelection();

Â  sel.removeAllRanges();

Â  sel.addRange(range);

Â  el.focus();

}



// ===== ë‚ ì§œ ìœ í‹¸ (KST ê¸°ì¤€) =====

function todayKSTISO(){

Â  const now = new Date();

Â  const utc = now.getTime() + now.getTimezoneOffset()*60000;

Â  const kst = new Date(utc + 9*3600000); // UTC+9

Â  const y = kst.getFullYear();

Â  const m = String(kst.getMonth()+1).padStart(2,'0');

Â  const d = String(kst.getDate()).padStart(2,'0');

Â  return `${y}-${m}-${d}`;

}

function fmtDate(iso){

Â  if(!iso) return '';

Â  const [y,m,d] = iso.split('-');

Â  return `${m.padStart(2,'0')}ì›” ${d.padStart(2,'0')}ì¼`;

}

function ensureToday(){

Â  const el = $('#reportDate');

Â  if(el && !el.value){ el.value = todayKSTISO(); }

}



// 100ì  í™˜ì‚°

function to100(score, base){ return Math.round((Number(score)/Number(base))*100); }



// í…ŒìŠ¤íŠ¸ ë²”ìœ„ ë ê´„í˜¸ ì•ˆì˜ ìˆ«ìë§Œ ë¶„ëª¨ë¡œ ì¸ì •. (7), (7ë¬¸í•­), (ì´7ë¬¸í•­) ë“± ëª¨ë‘ OK

function extractBaseFromRange(range){

Â  if(!range) return null;

Â  const s = String(range).trim();

Â  if(!s.endsWith(')')) return null;

Â  const start = s.lastIndexOf('(');

Â  if(start === -1) return null;

Â  const inside = s.slice(start+1, -1);

Â  const m = inside.match(/[0-9]{1,3}/);

Â  if(m){

Â  Â  const n = Number(m[0]);

Â  Â  if(Number.isFinite(n) && n>=1 && n<=999) return n;

Â  }

Â  return null;

}



// í•™ë…„-í•™ê¸° ì¶”ì •

function detectGradeSem(text){

Â  const t=String(text||'');

Â  const m=t.match(/(ì¤‘[1-3](?:-[12])?|ê³ [1-3](?:-[12])?|ê³µí†µìˆ˜í•™ ?I{1,2})/);

Â  return m?m[1]:'';

}

function normalizeRangeLabel(range, className){

Â  const gsInRange = detectGradeSem(range);

Â  if(gsInRange) return String(range||'').trim();

Â  const gsFromClass = detectGradeSem(className);

Â  return gsFromClass? (gsFromClass+' '+String(range||'').trim()) : String(range||'').trim();

}



// ì½¤ë§ˆ/ì¤„ë°”ê¿ˆ ë¶„í• 

function splitList(text){ return String(text||'').split(/[\,\n]/).map(s=>s.trim()).filter(Boolean); }



// í•™ìƒ í† í° íŒŒì„œ

function tokenizeStudent(str){

Â  const parts = str.split(/\s+/).filter(Boolean);

Â  const name = parts.shift();

Â  let dailyScore = '', base = null;

Â  let attendance = 'ì •ìƒ', attitude = 'ìš°ìˆ˜', homeworkStatus = 'ì •ìƒ';

Â  let attitudeFlag = null; const attitudeNotes = []; let testReason = '';

Â  for(const tRaw of parts){

Â  Â  const t = tRaw.replace(/[,ï¼Œ]/g,'');

Â  Â  if(/^(\d{1,3})\/(\d{1,3})$/.test(t)){ const [s,b]=t.split('/'); dailyScore=s; base=b; continue; }

Â  Â  if(/^\d{1,3}$/.test(t)){ if(dailyScore==='') dailyScore=t; else base=Number(t); continue; }

Â  Â  if(/ê²°ì„/.test(t)){ attendance='ê²°ì„'; if(!testReason) testReason='ê²°ì„ìœ¼ë¡œ ì¸í•´ í…ŒìŠ¤íŠ¸ ë¯¸ì‘ì‹œ'; continue; }

Â  Â  if(/ì§€ê°(\d+)?ë¶„?/.test(t)){ const m=t.match(/(\d+)/); attendance = m? `ì§€ê° ${m[1]}ë¶„` : 'ì§€ê°'; continue; }

Â  Â  if(/ê³¼ì œ.?ë¯¸í¡/.test(t)){ homeworkStatus='ë¯¸í¡'; continue; }

Â  Â  if(/ë¯¸ì‘ì‹œ|ë¬´ì‘ì‹œ|ê²°ì‹œ/.test(t)){ if(!testReason) testReason='í•™ìƒ ì‚¬ìœ ë¡œ í…ŒìŠ¤íŠ¸ ë¯¸ì‘ì‹œ'; continue; }

Â  Â  if(/ì‚¬ìœ \((.+)\)/.test(t)){ const m=t.match(/ì‚¬ìœ \((.+)\)/); if(m) testReason = m[1]; continue; }

Â  Â  if(/ì¡¸ìŒ|í”¼ê³¤|ì†Œê·¹|ì‚°ë§Œ/.test(t)){ attitudeFlag='down'; attitudeNotes.push(t); continue; }

Â  Â  if(/ì ê·¹ì |ì ê·¹|ì„±ì‹¤|ì§‘ì¤‘.?ì¢‹ìŒ|ì§ˆë¬¸ ?ì˜í•¨/.test(t)){ attitudeFlag='up'; attitudeNotes.push(t); continue; }

Â  }

Â  if(attitudeFlag==='up') attitude='ìš°ìˆ˜';

Â  if(attitudeFlag==='down') attitude='ë³´í†µ';

Â  return { name, dailyScore, base, attendance, attitude, homeworkStatus, attitudeNotes, testReason };

}



// íƒœë„ ì ìˆ˜(5ì  ë§Œì , ê²°ì„ 0)

function calcAttitudeScore(attendance, attitude, notes){

Â  if(String(attendance).includes('ê²°ì„')) return 0;

Â  if(notes && notes.some(n=>/(ì ê·¹|ì§ˆë¬¸)/.test(n))) return 5;

Â  if(attitude==='ìš°ìˆ˜') return 5;

Â  if(attitude==='ë³´í†µ') return 3;

Â  return 4;

}



// ê°œë… ì¶”ì¶œ(ë¦¬ë·°ì— 1ê°œ ì´ìƒ ë°˜ì˜)

function extractConcept(progress){

Â  const p=String(progress||'');

Â  if(/ë“±ì°¨ìˆ˜ì—´|ë“±ì°¨/.test(p)) return 'ë“±ì°¨ìˆ˜ì—´ì˜ ì¼ë°˜í•­ê³¼ í•©';

Â  if(/ë“±ë¹„ìˆ˜ì—´|ë“±ë¹„/.test(p)) return 'ë“±ë¹„ìˆ˜ì—´ì˜ ì¼ë°˜í•­ê³¼ í•©';

Â  if(/ìˆ˜ì—´ì˜ í•©|Î£|ì‹œê·¸ë§ˆ|ë¶€ë¶„í•©/.test(p)) return 'ì‹œê·¸ë§ˆ í‘œê¸°ì™€ ë¶€ë¶„í•© ê°œë…';

Â  if(/ì§€ìˆ˜í•¨ìˆ˜|ì§€ìˆ˜/.test(p)) return 'ì§€ìˆ˜í•¨ìˆ˜ì˜ ì¦ê°ê³¼ ê·¸ë˜í”„ í•´ì„';

Â  if(/ë¡œê·¸í•¨ìˆ˜|ë¡œê·¸/.test(p)) return 'ë¡œê·¸ ì„±ì§ˆê³¼ ê·¸ë˜í”„ í•´ì„';

Â  if(/ì‚¼ê°í•¨ìˆ˜|ì‚¬ì¸|ì½”ì‚¬ì¸|íƒ„ì  íŠ¸/.test(p)) return 'ì‚¼ê°í•¨ìˆ˜ì˜ ì£¼ê¸°ì™€ ê·¸ë˜í”„ í•´ì„';

Â  if(/ë‹®ìŒ/.test(p)) return 'ë‹®ìŒê³¼ ë¹„ë¡€ì‹ í™œìš©';

Â  if(/í™•ë¥ |ê²½ìš°ì˜ ìˆ˜/.test(p)) return 'ê²½ìš°ì˜ ìˆ˜ ê¸°ë³¸ì›ë¦¬ì™€ í™•ë¥ ';

Â  if(/ë¯¸ë¶„/.test(p)) return 'ë„í•¨ìˆ˜ì™€ ì¦ê°€ ê°ì†Œ íŒì •';

Â  if(/ì ë¶„/.test(p)) return 'ì •ì ë¶„ì„ ì´ìš©í•œ ë„“ì´ ê³„ì‚°';

Â  return '';

}



// ë¦¬ë·°(ë¬¸ì¥ë§ˆë‹¤ ì¤„ë°”ê¿ˆ, ì¡´ëŒ“ë§, íŠ¹ìˆ˜ê¸°í˜¸ ê¸ˆì§€)

function buildReview({name, attendance, attitude, homeworkStatus, scorePct, conceptsMention, testTaken, testReason}){

Â  const s=[];

Â  if(String(attendance).includes('ê²°ì„')){ s.push(name+' í•™ìƒì€ ì˜¤ëŠ˜ ê²°ì„í•˜ì˜€ìŠµë‹ˆë‹¤.'); s.push('ë‹¤ìŒ ìˆ˜ì—… ì „ ê³¼ì œ ì•ˆë‚´ë¥¼ ì „ë‹¬í•˜ê³  í•µì‹¬ ê°œë…ì„ ë¹ ë¥´ê²Œ ì ê²€í•˜ê² ìŠµë‹ˆë‹¤.'); return s.join('\n'); }

Â  if(attitude==='ìš°ìˆ˜') s.push('ìˆ˜ì—… íƒœë„ê°€ ì•ˆì •ì ì´ë©° ì§ˆë¬¸ê³¼ ì°¸ì—¬ê°€ ì ê·¹ì ì´ì—ˆìŠµë‹ˆë‹¤.');

Â  else if(attitude==='ë³´í†µ') s.push('ì§‘ì¤‘ì´ ì¼ì •í•˜ì§€ ì•Šì•„ í’€ì´ ê³¼ì •ì„ ë‹¨ê³„ë³„ë¡œ ì ê²€í•˜ì˜€ìŠµë‹ˆë‹¤.');

Â  else s.push('ìˆ˜ì—… íƒœë„ëŠ” ì¶”ê°€ ê´€ì°°ì´ í•„ìš”í•˜ì˜€ìŠµë‹ˆë‹¤.');

Â  if(conceptsMention) s.push('ì˜¤ëŠ˜ì€ '+conceptsMention+'ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë…ì„ ì ê²€í•˜ì˜€ìŠµë‹ˆë‹¤.');

Â  if(/ë¯¸í¡/.test(homeworkStatus)) s.push('ê³¼ì œ ìˆ˜í–‰ì´ ë¶€ì¡±í•˜ì—¬ í•µì‹¬ ë¬¸ì œë¥¼ ìš°ì„  ë³µìŠµí•˜ë„ë¡ ì•ˆë‚´í•˜ì˜€ìŠµë‹ˆë‹¤.');

Â  else s.push('ê³¼ì œ ìˆ˜í–‰ì´ ì•ˆì •ì ì´ì–´ì„œ ë‹¤ìŒ ì‹œê°„ì—ëŠ” ë‚œì´ë„ë¥¼ ì¡°ê¸ˆ ë†’ì´ê² ìŠµë‹ˆë‹¤.');

Â  if(testTaken){ if(scorePct<70) s.push('í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì´ˆ ìœ í˜•ë¶€í„° ì •í™•ë„ë¥¼ ëŒì–´ì˜¬ë¦¬ê² ìŠµë‹ˆë‹¤.'); else s.push('í…ŒìŠ¤íŠ¸ ê²°ê³¼ì— ë”°ë¼ ëŒ€í‘œ ìœ í˜•ì˜ ë³€í˜• ë¬¸ì œê¹Œì§€ í™•ì¥í•˜ê² ìŠµë‹ˆë‹¤.'); }

Â  else { s.push('ì˜¤ëŠ˜ì€ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ì§€ ëª»í•˜ì˜€ìŠµë‹ˆë‹¤.'); s.push('ë‹¤ìŒ ì‹œê°„ ë™ì¼ ë²”ìœ„ë¡œ í™•ì¸í•˜ê² ìŠµë‹ˆë‹¤.'); if(testReason) s.push('ë¯¸ì‘ì‹œ ì‚¬ìœ ë¥¼ ê¸°ë¡í•˜ì˜€ìŠµë‹ˆë‹¤.'); }

Â  return s.join('\n');

}



// ë¡œì»¬ í…œí”Œë¦¿(ê·œì • í˜•ì‹)

function localReportTemplate(p){

Â  const {name, className, dateStr, progress, homework, testLabel, score, base, attendance, attitude, homeworkStatus, teacherName, baseFromRange, attitudeNotes, notice, testReason} = p;

Â  const attScore = calcAttitudeScore(attendance, attitude, attitudeNotes);

Â  const gradeRange = normalizeRangeLabel(testLabel, className);

Â  let testTaken = !!score; let pct = null;

Â  if(score){ let den = base || baseFromRange; pct = den? to100(score, den) : Math.max(0, Math.min(100, Math.round(Number(score)))); }

Â  const progressItems = splitList(progress); const homeworkItems = splitList(homework);

Â  const conceptsMention = extractConcept(progress);

Â  const lines = [];

Â  lines.push(`ì•ˆë…•í•˜ì„¸ìš”. ê³ ìˆ˜í•™ í•™ì›ì…ë‹ˆë‹¤. ${dateStr} ${className} ${name}í•™ìƒì˜ í•™ìŠµ ì•ˆë‚´ì…ë‹ˆë‹¤.`);

Â  lines.push('');

Â  lines.push(`ì¶œê²°: ${attendance}`);

Â  lines.push(`íƒœë„: ${attitude} (${attScore}/5)`);

Â  lines.push(`ê³¼ì œ: ${homeworkStatus}`);

Â  lines.push('');

Â  lines.push('ìˆ˜ì—… ì§„ë„');

Â  if(progressItems.length){ progressItems.forEach(it=>lines.push(`- ${className}: ${it}`)); } else { lines.push('- ì…ë ¥ëœ ì§„ë„ ì—†ìŒ'); }

Â  lines.push('');

Â  lines.push('ê¸ˆì¼ ê³¼ì œ');

Â  if(homeworkItems.length){ homeworkItems.forEach(it=>lines.push(`- ${className}: ${it}`)); } else { lines.push('- ì…ë ¥ëœ ê³¼ì œ ì—†ìŒ'); }

Â  lines.push('');

Â  lines.push('ë°ì¼ë¦¬ í…ŒìŠ¤íŠ¸');

Â  lines.push(`- ë²”ìœ„: ${gradeRange || 'ì…ë ¥ê°’ í™•ì¸ í•„ìš”'}`);

Â  if(testTaken && pct!==null){ lines.push(`- ì ìˆ˜: ${pct}ì  (100ì  ë§Œì  ê¸°ì¤€)`); }

Â  else { lines.push(`- ì ìˆ˜: ë¯¸ê¸°ì¬`); lines.push(`- â€» í…ŒìŠ¤íŠ¸ ë¯¸ì‘ì‹œ: ${testReason || (attendance.includes('ê²°ì„')? 'ê²°ì„' : 'ìˆ˜ì—… ì‹œê°„ ë‚´ ë¯¸ì§„í–‰')}`); }

Â  lines.push('');

Â  lines.push('ìˆ˜ì—…ë¦¬ë·°');

Â  lines.push(buildReview({name, attendance, attitude, homeworkStatus, scorePct:pct??0, conceptsMention, testTaken, testReason}));

Â  lines.push('');

Â  if(teacherName) lines.push(`ë‹´ë‹¹: ${teacherName}`);

Â  if(notice && notice.trim()) { lines.push(''); lines.push('ê³µì§€ì‚¬í•­'); lines.push(`- ${notice.trim()}`); }

Â  return lines.join('\n');

}



// ===== ìƒíƒœ í‘œì‹œ ìœ í‹¸ =====

function ensureModeChip(){

Â  let holder=document.getElementById('modeChipHolder');

Â  if(!holder){

Â  Â  const firstCard=document.querySelector('.card');

Â  Â  holder=document.createElement('div');

Â  Â  holder.className='row';

Â  Â  holder.style.marginTop='6px';

Â  Â  holder.id='modeChipHolder';

Â  Â  const chip=document.createElement('div');

Â  Â  chip.id='modeChip';

Â  Â  chip.className='chip';

Â  Â  chip.textContent='ëª¨ë“œ: í™•ì¸ì¤‘';

Â  Â  holder.appendChild(chip);

Â  Â  if(firstCard) firstCard.appendChild(holder);

Â  }

Â  return document.getElementById('modeChip');

}

function setChip(text, style){

Â  const chip=ensureModeChip();

Â  chip.textContent=text;

Â  chip.classList.remove('ok','warn','bad');

Â  if(style==='ok') chip.classList.add('ok');

Â  else if(style==='bad') chip.classList.add('bad');

Â  else chip.classList.add('warn');

}

function refreshModeChip(){

Â  const useGpt=$('#useGpt')?.checked;

Â  const ep=($('#gptEndpoint')?.value||'').trim();

Â  if(useGpt){ setChip('ëª¨ë“œ: GPT ìš°ì„ '+(ep? ' Â· ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •ë¨':' Â· ì—”ë“œí¬ì¸íŠ¸ ë¯¸ì„¤ì • â†’ í´ë°±'),'warn'); }

Â  else { setChip('ëª¨ë“œ: ë¡œì»¬ ìƒì„±','ok'); }

}



// ===== GPT ì—°ë™ =====

async function fetchGptReport(payload){

Â  const url = ($('#gptEndpoint')?.value || '').trim();

Â  if(!url) throw new Error('GPT ì—”ë“œí¬ì¸íŠ¸ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.');

Â  const res = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });

Â  const data = await res.json();

Â  if(!data || !data.report) throw new Error('ì„œë²„ ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');

Â  return data.report;

}



// ===== íŒŒì„œ/ìœ í‹¸ =====

function parseInput(raw){

Â  const lines = String(raw||'').split(/\n+/).map(s=>s.trim()).filter(Boolean);

Â  let className='', progress='', homework='', testRange='', studentsRaw='';

Â  for(const line of lines){

Â  Â  const [key,...rest] = line.split(':');

Â  Â  const k = (key||'').trim();Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // â† í‚¤ íŠ¸ë¦¼ ë³´ê°•

Â  Â  const value = rest.join(':').trim();

Â  Â  if(/^ë°˜ëª…/.test(k)) className=value;

Â  Â  else if(/^ì§„ë„/.test(k)) progress=value;

Â  Â  else if(/^ê³¼ì œ/.test(k)) homework=value;

Â  Â  else if(/^í…ŒìŠ¤íŠ¸/.test(k)) testRange=value;Â  Â  // í…ŒìŠ¤íŠ¸ë²”ìœ„ / í…ŒìŠ¤íŠ¸ ë²”ìœ„ ëª¨ë‘ ì¸ì‹

Â  Â  else if(/^í•™ìƒ/.test(k)) studentsRaw+=(studentsRaw?', ':'')+value;

Â  }

Â  const students = studentsRaw.split(',').map(s=>s.trim()).filter(Boolean).map(tokenizeStudent);

Â  return {className, progress, homework, testRange, students};

}



// ===== ìƒì„± ë©”ì¸ =====

async function generateReports(){

Â  ensureToday();

Â  const raw=$('#inputData').value.trim(); if(!raw){alert('ì…ë ¥ ë°ì´í„°ë¥¼ ë¨¼ì € ë„£ì–´ì£¼ì„¸ìš”.');return;}

Â  const teacherName=$('#teacherName').value.trim(); const dateIso=$('#reportDate').value || todayKSTISO(); const notice=$('#notice').value.trim();

Â  const {className,progress,homework,testRange,students}=parseInput(raw);

Â  const dateStr=fmtDate(dateIso); const baseFromRange=extractBaseFromRange(testRange);

Â  const useGpt = $('#useGpt')?.checked; const container=$('#reports'); container.innerHTML=''; const bundle=[]; let gptOk=0,gptFallback=0,localOk=0;



Â  for(const s of students){

Â  Â  const payload={ name:s.name, className, progress, homework, testRange: testRange||'ë°ì¼ë¦¬ í…ŒìŠ¤íŠ¸', score:s.dailyScore, base:s.base, attendance:s.attendance, attitude:s.attitude, homeworkStatus:s.homeworkStatus, teacherName, dateStr, attitudeNotes:s.attitudeNotes, testReason: (s.testReason || (/ìƒëµ/.test(testRange)? 'í…ŒìŠ¤íŠ¸ ìƒëµ' : '')), notice };

Â  Â  let text;

Â  Â  if(useGpt){

Â  Â  Â  try{ text = await fetchGptReport(payload); console.info('[GPT OK]', s.name); gptOk++; }

Â  Â  Â  catch(e){ console.warn('GPT ì‹¤íŒ¨, ë¡œì»¬ í´ë°±:', s.name, e); gptFallback++; text = localReportTemplate({ ...payload, testLabel: payload.testRange, baseFromRange, attitudeNotes: s.attitudeNotes }); }

Â  Â  } else {

Â  Â  Â  text = localReportTemplate({ ...payload, testLabel: payload.testRange, baseFromRange, attitudeNotes: s.attitudeNotes }); localOk++;

Â  Â  }

Â  Â  const item=document.createElement('div'); item.className='report-item';

Â  Â  const block=document.createElement('div'); block.className='report'; block.contentEditable=true; block.textContent=text;

Â  Â  const btn=document.createElement('button'); btn.className='btn secondary sm'; btn.textContent='ğŸ“‹ ë³µì‚¬';

Â  Â  btn.addEventListener('click', async ()=>{

Â  Â  Â  const ok = await copyToClipboard(block.innerText || block.textContent);

Â  Â  Â  if(ok){

Â  Â  Â  Â  alert(s.name + ' í•™ìƒ ë¦¬í¬íŠ¸ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤.');

Â  Â  Â  }else{

Â  Â  Â  Â  selectNodeText(block);

Â  Â  Â  Â  alert('ë¸Œë¼ìš°ì € ì •ì±…ìœ¼ë¡œ ìë™ ë³µì‚¬ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. í˜„ì¬ ë¦¬í¬íŠ¸ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤. âŒ˜/Ctrl + C ë¥¼ ëˆŒëŸ¬ ë³µì‚¬í•´ ì£¼ì„¸ìš”.');

Â  Â  Â  }

Â  Â  });

Â  Â  item.appendChild(block); item.appendChild(btn); container.appendChild(item); bundle.push(text);

Â  }

Â  $('#count').textContent=bundle.length+'ê±´';

Â  const ep=( $('#gptEndpoint')?.value || '' ).trim();

Â  if(useGpt){

Â  Â  if(!ep){ setChip('ëª¨ë“œ: GPT ìš°ì„  Â· ì—”ë“œí¬ì¸íŠ¸ ì—†ìŒ â†’ ë¡œì»¬ '+(localOk+gptFallback)+'ê±´','warn'); }

Â  Â  else { setChip('ëª¨ë“œ: GPT ìš°ì„  Â· ì„±ê³µ '+gptOk+'ê±´ Â· í´ë°± '+gptFallback+'ê±´', gptFallback? 'warn':'ok'); }

Â  }else{

Â  Â  setChip('ëª¨ë“œ: ë¡œì»¬ ìƒì„±','ok');

Â  }

}



function copyAllReports(){

Â  const all = $$('.report').map(d=>d.innerText || d.textContent).join('\n\n');Â  // â† ì˜¤íƒ€ ì œê±°

Â  if(!all.trim()){ alert('ë³µì‚¬í•  ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

Â  copyToClipboard(all).then(ok=>{

Â  Â  if(ok) alert('ë°˜ ì „ì²´ ë¦¬í¬íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');

Â  Â  else alert('ë¸Œë¼ìš°ì € ì •ì±…ìœ¼ë¡œ ìë™ ë³µì‚¬ê°€ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ê° ë¦¬í¬íŠ¸ì˜ ë³µì‚¬ ë²„íŠ¼ì„ ì´ìš©í•˜ê±°ë‚˜ í…ìŠ¤íŠ¸ë¥¼ ë“œë˜ê·¸í•œ ë’¤ âŒ˜/Ctrl + C ë¡œ ë³µì‚¬í•´ ì£¼ì„¸ìš”.');

Â  });

}



function downloadTxt(){

Â  const all=$$('.report').map(d=>d.textContent).join('\n\n');

Â  if(!all.trim()){alert('ë‚´ë³´ë‚¼ ë¦¬í¬íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');return;}

Â  const blob=new Blob([all],{type:'text/plain;charset=utf-8'});

Â  const a=document.createElement('a');

Â  a.href=URL.createObjectURL(blob);

Â  a.download=`ê³ ìˆ˜í•™_ë¦¬í¬íŠ¸_${$('#reportDate').value}.txt`;

Â  document.body.appendChild(a); a.click(); a.remove();

}



// ===== ì´ˆê¸°í™” & ë¡œì»¬ ì €ì¥ =====

(function init(){

Â  ensureToday();

Â  $('#btn-generate')?.addEventListener('click', ()=>generateReports());

Â  $('#btn-copy-all')?.addEventListener('click', copyAllReports);

Â  $('#btn-download')?.addEventListener('click', downloadTxt);

Â  $('#btn-sample')?.addEventListener('click', ()=>{ $('#inputData').value=`ë°˜ëª…: ì¤‘3T(ìˆ˜ìš©)

ì§„ë„: ì¤‘3-1 ìˆ˜ì—´ì˜ í•©(Î£), ë“±ì°¨ìˆ˜ì—´ ì¼ë°˜í•­

ê³¼ì œ: ì¤‘3-1 ìˆ˜ì—´ P1~P3, ì˜¤ë‹µì •ë¦¬

í…ŒìŠ¤íŠ¸ ë²”ìœ„: ì¤‘3-1 ë“±ì°¨ìˆ˜ì—´ ëŒ€í‘œìœ í˜• (6)

í•™ìƒ: ì´ì¢…ì°¬ 5 ì ê·¹ì , ê¹€ë„ìœ¤ 4 ì§ˆë¬¸ ì˜í•¨, êµ¬ë™ê±´ ë¯¸ì‘ì‹œ(ì‚¬ìœ : ì¡°í‡´), ë°•íƒœì˜ ê²°ì„`; });

Â  $('#btn-clear')?.addEventListener('click', ()=>{ $('#inputData').value=''; $('#extraRequest').value=''; $('#notice').value=''; $('#reports').innerHTML=''; $('#count').textContent='0ê±´'; });

Â  $('#btn-today')?.addEventListener('click', ()=>{ $('#reportDate').value = todayKSTISO(); });

Â  try{

Â  Â  const ep=localStorage.getItem('gomath_gptEndpoint'); if(ep) $('#gptEndpoint').value=ep;

Â  Â  const ug=localStorage.getItem('gomath_useGpt');

Â  Â  $('#useGpt').checked = ug ? (ug==='1') : true;

Â  Â  if(!ug) localStorage.setItem('gomath_useGpt','1');

Â  }catch{}

Â  $('#gptEndpoint')?.addEventListener('change', ()=>{ try{ localStorage.setItem('gomath_gptEndpoint',$('#gptEndpoint').value.trim()); }catch{} refreshModeChip(); });

Â  $('#useGpt')?.addEventListener('change', ()=>{ try{ localStorage.setItem('gomath_useGpt',$('#useGpt').checked?'1':'0'); }catch{} refreshModeChip(); });

Â  refreshModeChip();

})();

</script>

</body>

</html>
